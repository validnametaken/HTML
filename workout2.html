<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exercise Timer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 30px;
            max-width: 600px;
        }

        #workout {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 20px;
        }

        .button-container {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .exercise-media {
            max-width: 500px;
            max-height: 500px;
            display: block;
            margin: 10px 0;
            object-fit: contain;
            background: #f0f0f0;
            /* Fallback background */
        }

        img.exercise-media[src=""],
        img.exercise-media:not([src]),
        video.exercise-media[src=""],
        video.exercise-media:not([src]) {
            display: none;
        }

        #timer {
            font-size: 6em;
            margin: 20px 0;
            color: blue;
        }

        #current-exercise {
            font-weight: bold;
            font-size: 1.2em;
        }

        #status {
            margin-bottom: 20px;
            font-style: italic;
            font-size: 2em;
        }

        #exercise-explanation {
            white-space: pre-wrap;
            margin-bottom: 20px;
            font-style: italic;
            font-size: 4em;
        }

        button {
            padding: 8px 16px;
            font-size: 1em;
        }

        #progress-bar-container {
            width: 80%;
            background-color: #ddd;
            border-radius: 10px;
            overflow: hidden;
            height: 20px;
            margin-bottom: 20px;
        }

        #progress-bar {
            height: 100%;
            width: 0%;
            background-color: #4caf50;
            transition: width 0.3s ease;
        }

        @media (max-width: 768px) {
            #timer {
                font-size: 3em;
            }

            #exercise-explanation {
                font-size: 2em;
            }

            .exercise-img {
                max-width: 100%;
            }

            body {
                margin: 15px;
            }
        }


        /* Two-column landscape layout */
        @media screen and (orientation: landscape) {
            body {
                margin: 10px;
                max-width: none;
            }

            h1 {
                font-size: 1.2em;
                margin: 5px 0;
            }

            #workout {
                display: flex;
                flex-direction: row;
                gap: 20px;
                margin-top: 10px;
                height: calc(100vh - 60px);
                /* Use most of screen height */
            }

            .left-column {
                flex: 1.2;
                /* Slightly wider for images */
                display: flex;
                flex-direction: column;
                gap: 8px;
                overflow-y: auto;
                /* Allow scrolling if needed */
            }

            .right-column {
                flex: 0.8;
                display: flex;
                flex-direction: column;
                gap: 15px;
                align-items: center;
                justify-content: center;
                padding: 10px;
                background-color: #f9f9f9;
                border-radius: 10px;
            }

            /* Left column styling */
            #current-exercise {
                font-size: 2.5em;
                font-weight: bold;
            }

            .exercise-media {
                max-width: 100% !important;
                max-height: 70% !important;
                margin: 5px 0;
            }

            #next-exercise-img {
                max-width: 100% !important;
                max-height: 70% !important;
                margin: 5px 0;
            }

            #exercise-explanation {
                font-size: 1em !important;
                margin-bottom: 10px;
            }

            #next-exercise {
                font-size: 2.1em;
                font-weight: bold;
            }

            /* Right column styling */
            #timer {
                font-size: 10vw !important;
                margin: 0;
                text-align: center;
            }

            #status {
                font-size: 5vw !important;
                margin: 0;
                text-align: center;
            }

            #progress-bar-container {
                width: 100%;
                height: 20px;
                margin: 10px 0;
            }

            .button-container {
                display: flex;
                flex-direction: column;
                gap: 8px;
                width: 100%;
            }

            button {
                padding: 10px 15px;
                font-size: 1em;
                width: 100%;
            }
        }

        /* For very short landscape screens */
        @media screen and (orientation: landscape) and (max-height: 400px) {
            #timer {
                font-size: 2.2em !important;
            }

            #status {
                font-size: 1.1em !important;
            }

            .right-column {
                gap: 10px;
                padding: 5px;
            }

            button {
                padding: 6px 10px;
                font-size: 0.9em;
            }

            .exercise-img {
                max-height: 150px !important;
            }
        }
    </style>
</head>

<body>
    <h1>Exercise Timer (v. 4) </h1>
    <div id="workout">
        <div class="left-column">
            <div id="next-exercise" margin-bottom: 10px;></div>
            <img id="next-exercise-img" class="exercise-media"
                style="display:none; max-width:200px; margin-bottom:10px;" alt="Next Exercise Image" />
            <!-- <div id="next-exercise-text" class="exercise-media" style="display:none; font-size:2em; text-align:center;"></div> -->
            <video id="next-exercise-video" class="exercise-media"
                style="display:none; max-width:200px; margin-bottom:10px;" controls muted loop></video>

            <div id="current-exercise"></div>
            <img id="exercise-img" class="exercise-media" src="" alt="Current Exercise Image" />
            <div id="exercise-text" class="exercise-media" style="display:none; font-size:10vw; text-align:center;">
            </div>
            <video id="exercise-video" class="exercise-media" src="" alt="Current Exercise Video" controls muted
                loop></video>
            <div id="exercise-explanation" style="font-style: italic; margin-bottom: 10px;"></div>
        </div>

        <div class="right-column">
            <div id="timer"></div>
            <div id="status"></div>

            <div id="progress-bar-container">
                <div id="progress-bar"></div>
            </div>

            <div class="button-container">
                <button id="startBtn">Start</button>
                <button id="pauseBtn" disabled>Pause</button>
                <button id="resumeBtn" disabled>Resume</button>
                <button id="resetBtn" disabled>Reset</button>
                <button id="skipBtn" disabled>Skip</button>
            </div>
        </div>
    </div>


    <script>
        // Define exercise groups
        const warmupExercises = [
            { name: "Get ready!", reps: 1, repDuration: 3, breakBetweenReps: 2, breakBetweenExercises: 5, imgUrl: "Get Ready", explanation: "Get Ready!" },
            { name: "Torso Rotations", reps: 1, repDuration: 20, breakBetweenReps: 2, breakBetweenExercises: 5, imgUrl: "exercise/torsorotations.jpg", explanation: "Starting Position:\nStand with your feet about shoulder-width apart. You can either place your hands on your hips or bend your arms 90 degrees at your sides. Keep your back straight and your core gently engaged. \n\nRotation: \nSlowly rotate your upper body (torso and shoulders) to one side as far as is comfortable. Allow the foot on the opposite side to pivot slightly on the ball of the foot to avoid excessive twisting in the knee and lower back. \n\nReverse: \nReturn to the starting center position in a controlled manner. \n\nOpposite Side: \nRepeat the rotation to the other side, pivoting the opposite foot. Form Tips: The movement should be slow and controlled, focusing on the rotation coming from your trunk, not just swinging your arms. Keep your head relatively aligned with your torso." },
            { name: "Arm Circles", reps: 2, repDuration: 15, breakBetweenReps: 2, breakBetweenExercises: 5, imgUrl: "exercise/armcircles.jpg", explanation: "Starting Position: \nStand upright with your feet about shoulder-width apart. Extend both arms straight out to your sides at shoulder height, forming a T shape with your body.\n\nForward Circles: \nBegin by rotating both arms forward simultaneously in small, controlled circular motions. \n\nReverse Direction: \nOnce you complete the desired time or repetitions, immediately reverse the direction and rotate your arms backward. \n\n Form Tips: \nKeep your arms straight and your core stable to prevent your back from arching or swaying. The movement should be smooth and controlled, originating from the shoulder joint." },
            { name: "Step Jacks", reps: 1, repDuration: 20, breakBetweenReps: 2, breakBetweenExercises: 5, imgUrl: "exercise/stepjacks.jpg", explanation: "Starting Position: \nStand upright with your feet together and your arms resting at your sides.\n\nStep Out and Up: \nStep your right foot out wide to the side. Simultaneously, swing both arms out to the sides and up over your head until your hands nearly touch (like the top of a Jumping Jack).\n\nReturn to Center:\nStep your right foot back to meet your left foot. At the same time, bring both arms back down to your sides in a controlled motion.\n\nAlternate Sides: \nRepeat the entire movement on the opposite side, stepping out with your left foot and raising your arms overhead.\n\nFlow: \nContinue alternating sides, keeping a steady, fluid rhythm. Maintain good posture and keep your core engaged throughout the movement." },
            { name: "High Knees", reps: 1, repDuration: 20, breakBetweenReps: 2, breakBetweenExercises: 10, imgUrl: "exercise/highknees.jpg", explanation: "Starting Position: \nStand tall with your feet hip-width apart and your arms bent at 90 degrees, held close to your sides, as if you were about to run.\n\nThe Movement: \nBegin walking in place. As you do, drive one knee up toward your chest (aiming for hip level or a 90-degree bend) and quickly return that foot to the ground.\n\nAlternate and Pump: \nImmediately switch legs, driving the opposite knee up. Maintain a quick, continuous, and rhythmic alternating motion.\n\nArm Action: \nKeep your core engaged and pump your arms vigorously in coordination with the opposite leg, just as you would while sprinting.\n\nForm Tips: \nLand softly on the balls of your feet to reduce impact. Keep your back straight, chest up, and avoid leaning backward. To make it a lower-impact exercise, you can start with a slow, controlled marching motion." }
        ];

                const liedownExercises = [
            { name: "Glute Bridges", reps: 14, repDuration: 5, breakBetweenReps: 2, breakBetweenExercises: 15, imgUrl: "exercise/glutebridge.jpg", explanation: "Starting Position: \nLie on your back on the floor with your knees bent and feet flat on the ground. Your feet should be hip-width apart and positioned so that your fingertips can just graze your heels. Rest your arms straight by your sides, palms flat on the floor.\n\nEngage and Lift: \nSqueeze your glutes (buttocks) and brace your core (imagine pulling your belly button toward your spine). Press through your heels and drive your hips upward off the floor.\n\nTop Position: \nContinue lifting until your body forms a straight, diagonal line from your shoulders to your knees. Avoid over-arching your lower back; the movement should come from the hip extension, powered by your glutes.\n\nHold and Lower: \nSqueeze your glutes tightly at the top of the movement for a few seconds hold. Then, slowly and with control, lower your hips back down to the starting position on the floor.\n\nRepeat: \nComplete the desired number of repetitions, maintaining core engagement throughout the entire set." },
            { name: "Superman", reps: 10, repDuration: 5, breakBetweenReps: 2, breakBetweenExercises: 15, imgUrl: "exercise/superman.jpg", explanation: "Starting Position: \nLie face-down on the floor with your legs straight and your arms extended straight out in front of you (like Superman flying). Keep your head in a neutral position by gazing at the floor.\n\nEngage and Lift: \nSimultaneously and slowly lift your arms, chest, and legs a few centimeters off the floor. The movement should be controlled, focusing on squeezing your glutes and lower back muscles (the erector spinae).\n\nTop Position: \nLift only as high as you comfortably can without feeling strain in your lower back. Your belly button should remain near or on the floor. Keep your neck relaxed and straight by continuing to look down.\n\nHold and Lower: \nHold the top position for a a few seconds, maintaining the squeeze in your glutes and back. Then, slowly and with control, lower your arms and legs back down to the starting position.\n\n Repeat: \nBriefly rest on the floor before beginning the next repetition. Avoid rocking or moving too quickly." },

        ];

        const armsExercises = [
            { name: "Push-ups", reps: 5, repDuration: 5, breakBetweenReps: 2, breakBetweenExercises: 15, imgUrl: "exercise/pushup.png", explanation: "Starting Position (High Plank): \nStart on your hands and knees. Place your hands on the floor slightly wider than your shoulders, with your fingers pointing forward. Extend your legs straight behind you, balancing on your toes. Your body should form one straight line from your head to your heels.\n\nEngage Core: \nBrace your core and squeeze your glutes tightly to prevent your hips from sagging or rising. Keep your neck neutral by looking down at the floor.\n\nLower Down: \nInhale and slowly bend your elbows, lowering your chest toward the floor. Keep your elbows tucked in at a 45-degree angle from your body (avoid letting them flare out to the sides).\n\nPush Up: \nExhale and powerfully push through your palms to straighten your arms, returning to the high plank starting position. Maintain a straight body line throughout the entire movement.\n\nRepeat: \nComplete the desired number of repetitions, focusing on a slow, controlled descent and a powerful push up." },
            { name: "Self-arm wrestling", reps: 8, repDuration: 6, breakBetweenReps: 2, breakBetweenExercises: 15, imgUrl: "exercise/selfarmwrestle.jpg", explanation: "Starting Position: \nStand and lock hands (one will act as your 'opponent').\n\nGrip: \nYour dominant hand should mimic a arm wrestling grip. Your non-dominant hand wraps around it to provide resistance. Focus on a strong, unyielding grip with your dominant hand.\n\nApply Tension (The 'Wrestle'):\nEngage the muscles of your dominant arm (forearm, bicep, and shoulder) as if you are trying to beat an opponent. At the same time, use your non-dominant arm to resist the movement, creating a static, pushing tension (like a max-effort hold).\n\Hold: \nHold this isometric contraction for a set period, maintaining maximum tension and fighting for control. Do not allow either arm to move.\n\nRelease and Switch: \nSlowly release the tension and rest briefly. After completing the hold with your dominant arm, switch hands and repeat the process. \n\nNote: \nTo target different angles of the arm wrestling motion (e.g., pronation or 'toproll'), you can adjust your grip to focus on turning your wrist down or up against your own resistance." },
            { name: "Push-up to Plank", reps: 10, repDuration: 5, breakBetweenReps: 2, breakBetweenExercises: 15, imgUrl: "exercise/plank.jpg", explanation: "Starting Position (High Plank): \nBegin in a high plank position. Your hands should be placed directly beneath your shoulders, arms straight, and your body forming a straight line from head to heels. Engage your core and squeeze your glutes.\n\nLower Down to Forearm Plank: \nLead with one arm (e.g., the right arm). Lower your right forearm to the ground where your hand was, then immediately follow with your left forearm, so you are now in a standard forearm plank position. Keep your core braced to prevent your hips from swaying or tilting.\n\nPush Up to High Plank: \nLead with the same arm (the right arm). Place your right hand back on the ground, pressing up to straighten the arm. Immediately follow with your left hand, returning to the high plank starting position.\n\nRepeat and Alternate: \nContinue the movement, but on the next repetition, alternate the leading arm. For instance, go down left-right and come up left-right. The goal is to perform the exercise with minimal hip rotation or movement.\n\nPacing: \nFocus on a slow, controlled movement rather than speed. Maintaining a rigid, straight spine and square hips is more important than the number of reps." },
            { name: "Down Under", reps: 6, repDuration: 6, breakBetweenReps: 2, breakBetweenExercises: 15, imgUrl: "exercise/downunder.jpg", explanation: "Starting Position (Downward Dog): \nBegin on your hands and feet. Push your hips high and back, forming an inverted 'V' shape with your body. Your hands should be slightly wider than shoulder-width, fingers spread, and your head should be between your arms. This is the Downward Dog position.\n\nThe Dive (The Down Under): \nBend your elbows and, in a smooth, continuous, sweeping motion, lower your chest in an arc towards the floor, as if you are diving under a low bar. Your head should sweep down toward the ground, then forward past your hands.\n\nThe Push-Up and Arch (The Cobra): \nAs your chest clears the floor, straighten your arms to lift your torso up, arching your back and lifting your head and chest up and forward. Your hips should be near, but not resting on the floor, with the tops of your feet flat or toes tucked (depending on your preference). This resembles the Cobra or Upward-Facing Dog pose.\n\nThe Return: \nFrom the arched position, use your core and shoulder strength to lift your hips back up and back, reversing the movement to return to the Downward Dog starting position. The movement should be fluid, completing a full cycle of contraction and extension." },
            { name: "Tricep Dips", reps: 6, repDuration: 5, breakBetweenReps: 2, breakBetweenExercises: 15, imgUrl: "exercise/tricepdips.jpg", explanation: "Starting Position: \nSit on the edge of a stable bench, box, or sturdy chair. Place your hands shoulder-width apart, gripping the edge with your fingers pointing forward (towards your feet) or slightly out to the sides. \n\nSetup: \nKeeping your back straight, slide your hips forward off the bench. Your weight should be supported by your hands and your feet. Keep your legs straight or bent at a 90-degree angle (bent knees make the exercise easier).\n\nThe Descent (Dip): \nKeeping your torso upright and your back close to the bench, slowly bend your elbows, lowering your body toward the floor. Ensure your elbows point straight back behind you, not flaring out to the sides.\n\nThe Bottom: \nContinue lowering until your upper arms are roughly parallel to the floor, forming a 90-degree angle at the elbow, or as low as your shoulder comfort allows. Keep your shoulders down, away from your ears.\n\nThe Ascent (Push-Up): \nPress firmly through your palms, engaging your triceps to straighten your arms and push your body back up to the starting position. Stop just short of locking your elbows to maintain tension on the triceps. Repeat for the desired number of repetitions." }
        ];

        const coreExercises = [
            { name: "Rotating Plank", reps: 6, repDuration: 10, breakBetweenReps: 3, breakBetweenExercises: 15, imgUrl: "exercise/sideplank.jpg", explanation: "Starting Position (Plank): \nBegin in a standard high or low plank position: hands directly under your shoulders, body in a straight line from head to heels. Your feet should be placed slightly wider than hip-width apart for better stability.\n\n2. **First Rotation (Right Arm Up): \nShift your weight onto your left arm and the outside edge of your left foot. Engage your core as you pivot your body and rotate to your right. Lift your right arm straight up toward the ceiling. Your body should form a T shape, and your hips should be stacked (one directly above the other).\n\nReturn to Center: \nHold the side plank briefly, then slowly rotate back down, bringing your right hand back to the floor to return to the original plank position.\n\nSecond Rotation (Left Arm Up): \nShift your weight onto your right arm and the outside edge of your right foot. Engage your core as you pivot and rotate to your left. Lift your left arm straight up toward the ceiling.\n\nAlternating Repetition: \nReturn the left hand to the floor to return to the plank position. Continue to alternate the rotation from side to side for the desired number of repetitions or time." },
            { name: "Inchworms", reps: 10, repDuration: 6, breakBetweenReps: 2, breakBetweenExercises: 15, imgUrl: "exercise/inchworms.jpg", explanation: "Starting Position: \nStand tall with your feet hip-width apart and your core engaged. Keep your legs as straight as possible without locking your knees.\n\nHinge and Reach: \nHinge at your hips and bend down to place your hands on the floor a few inches in front of your feet. Bend your knees slightly if your hamstrings are too tight to reach the floor.\n\nWalk Out: \nSlowly walk your hands forward, one at a time (like an inchworm), keeping your core tight and your back flat. Continue walking your hands until your body forms a straight line from your head to your heels, ending in a high plank position (hands directly under your shoulders).\n\nWalk Back: \nPause in the plank for a moment. Now, keeping your hands planted, begin to walk your hands backs in small steps, one at a time. Keep your legs as straight as you comfortably can to feel a stretch in your hamstrings and calves. Your hips will lift toward the ceiling as your hands get closer to your feet.\n\nReturn to Start: \nContinue walking your hands back until you can no longer keep your legs straight (or they are as close to your feet as possible). From this 'pike' position, stand back up by straightening your torso. That completes one repetition. Repeat the entire cycle: Hands Out, Hands In." },
            { name: "Standing bicycle crunch (Alternating)", reps: 10, repDuration: 4, breakBetweenReps: 3, breakBetweenExercises: 15, imgUrl: "exercise/bicyclecrunch.jpg", explanation: "Starting Position: \nStand tall with your feet about hip-width apart and a soft bend in your knees. Place your hands lightly behind your head, flaring your elbows out wide. Engage your core by keeping your chest up and a slight brace in your abdomen. \n\nFirst Rep (Twist Right): \nExhale as you simultaneously lift your right knee up toward your chest and twist your torso to bring your left elbow toward that knee. Focus on crunching your side muscles (obliques) to initiate the movement, maintaining your balance on your standing leg. \n\nReturn to Center: \nInhale as you smoothly lower your right foot back to the floor and return your torso to the upright starting position. \n\nSecond Rep (Twist Left): \nExhale as you immediately repeat the movement on the opposite side: lift your left knee up and twist your torso to bring your right elbow toward that knee. \n\nAlternating Repetition: \nContinue to alternate sides in a controlled, rhythmic motion, emphasizing the crunch and twist in your core rather than just pulling your leg or leaning forward." },
            { name: "ab-rolls", reps: 6, repDuration: 6, breakBetweenReps: 2, breakBetweenExercises: 15, imgUrl: "exercise/abwheel.jpg", explanation: "Starting Position: \nKneel on a mat with your knees directly under your hips (or slightly behind them for more intensity). Place the ab wheel on the floor directly under your shoulders. Grip the handles with straight arms. Tuck your pelvis slightly and brace your core hard, keeping your back flat—you should look like a straight line from your head to your knees. \n\nThe Rollout (Eccentric Phase): \nSlowly and with deliberate control, push the wheel forward. Maintain the tight, braced core position, focusing on preventing your lower back from arching (anti-extension). Your arms should remain straight, and your hips should move with your shoulders. \n\nThe End Point: \nRoll out only as far as you can maintain the perfect, flat-back position. Stop immediately if you feel your lower back begin to sag or arch. \n\nThe Return (Concentric Phase): \nExhale and intensely squeeze your abs and lats to pull the wheel back to the starting position. The force should come from your core, reeling your body in, not from a push with your hips or arms. \n\nRepetition: \nReset your core brace and repeat the movement, focusing on slow control, especially during the rollout phase." },
            { name: "Dog-bird", reps: 2, repDuration: 30, breakBetweenReps: 2, breakBetweenExercises: 15, imgUrl: "exercise/dogbird.jpg", explanation: "Starting Position (Tabletop): \nBegin on all fours in a tabletop position. Your knees should be directly under your hips and your hands directly under your shoulders, creating a stable box shape. Look down at the floor to keep your neck in line with your spine. Engage your abs slightly to brace your core and establish a neutral spine (flat back). \n\nThe Extension: \nExhale and slowly extend one arm straight out in front (palm facing inward) and the opposite leg straight out behind you. Both limbs should stop at hip/shoulder height, forming a straight, parallel line with your torso. \n\nHold and Stabilize: \nThe critical part of the movement is the pause. Hold the extended position for a few seconds, focusing on keeping your hips and shoulders square to the floor (imagine balancing a glass of water on your lower back). Do not allow your lower back to arch or your torso to rotate. Try to reach as far forward and backwards as possible. \n\nThe Return: \nInhale as you slowly and with control return the extended arm and leg back to the tabletop starting position. \n\nAlternating Repetition: \nImmediately repeat the movement on the opposite side (the other arm and leg). Continue to alternate sides smoothly, maintaining a braced core throughout the entire set." }

        ];

        const legsExercises = [
            { name: "Squats", reps: 10, repDuration: 5, breakBetweenReps: 2, breakBetweenExercises: 15, imgUrl: "exercise/squat.jpg", explanation: "Starting Position: \nStand tall with your feet about shoulder-width apart, or slightly wider—whatever feels most stable and natural for your body. Your toes should be pointed slightly outward (about 10 to 30 degrees). Keep your chest up and your core braced. \n\nThe Descent (Lowering Phase): \nInitiate the movement by simultaneously pushing your hips back and bending your knees, as if you are trying to sit down in a chair far behind you. As you lower, actively push your knees out so they track in line with your feet/toes. Keep your chest up and your spine neutral—your torso will naturally lean forward, but avoid rounding your lower back. \n\nThe Depth: \nContinue lowering until your hip crease drops below your knees (parallel or deeper), or as far down as you can comfortably go without your lower back rounding or your heels lifting off the floor. Your weight should remain balanced over the middle of your feet. It's important to ensure that your knees never exceed your toes. \n\nThe Ascent (Lifting Phase): \nDrive forcefully through your entire foot (especially the heels and outside edges) to push yourself back up to the starting position. Focus on squeezing your glutes to drive your hips forward as you fully stand up. \n\nRepetition: \nReturn to the tall, standing position, maintain your core tension, and immediately begin the next repetition." },
            { name: "StationaryLunges", reps: 2, repDuration: 45, breakBetweenReps: 4, breakBetweenExercises: 15, imgUrl: "exercise/stationarylunge.png", explanation: "Starting Position: \nStart kneeling on the ground (a mat or cushion is helpful for comfort). Place one foot forward, creating two 90 degree angles: one at the front knee and one at the back knee. Your feet should be hip-width apart for better stability. Core is tight and your torso is straight and tall.\n\nThe Ascent (Lifting Phase): \nDrive your weight through the front foot and the toes of the back foot to lift your body straight up until your front leg is fully extended (or mostly straight). Keep your torso vertical and your hips squared forward. \n\nThe Top Position: \nPause briefly at the top in a tall split-stance standing position. \n\nThe Descent (Lowering Phase): \nSlowly and with control, lower your body straight back down until your back knee almost touches the ground (or returns to the starting position). Control the weight all the way down, do not let gravity drop you. \n\nRepetition: You can either pause briefly on the ground (to reset your balance) or immediately drive back up for the next rep. Complete all reps on this side before switching legs." },
            { name: "Calf Raises", reps: 10, repDuration: 5, breakBetweenReps: 4, breakBetweenExercises: 15, imgUrl: "exercise/calfraises.png", explanation: "Starting Position: \nStand tall with your feet about hip-width apart and your toes pointing straight ahead. If you need balance, lightly rest your hands on a wall, chair back, or sturdy object. \n\nThe Ascent (Lifting Phase): \nKeeping your legs straight (but without locking your knees), slowly press through the balls of your feet to raise your heels off the floor. Continue rising until you are as high up on your toes as possible. Pause and squeeze the calf muscles hard at the very top of the movement. \n\nThe Top Position: \nYou should be on your tiptoes, feeling a strong contraction in the back of your lower leg. Avoid rolling your ankles outward or inward. \n\nThe Descent (Lowering Phase): \nSlowly and with control, lower your heels back down to the starting position. Take your time on the way down (this is the most effective part of the exercise for muscle growth). \n\nRepetition: \nImmediately begin the next repetition without resting your weight on your heels at the bottom. The goal is to keep tension on the calf muscles throughout the set." },
            { name: "Single Leg Deadlift", reps: 10, repDuration: 10, breakBetweenReps: 2, breakBetweenExercises: 15, imgUrl: "exercise/onelegdeadlift.png", explanation: "Starting Position: \nStand tall with your feet hip-width apart and a soft bend in your knees. Maintain a neutral spine and brace your core.\n\nFirst Rep (Right Leg Standing): \nShift your weight onto your right leg (the standing leg). Slowly begin to hinge at the right hip, pushing your hips backward. As your torso lowers toward the ground, simultaneously lift and extend your left leg straight back. Your body should form a straight line from your head to your left heel. Keep your hips square (level and facing the floor) and go only as low as you can without rounding your back or losing balance.\n\nReturn to Center: \nDrive through the heel of your right leg to return to a standing position, bringing your left foot back to meet your right.\n\nSecond Rep (Left Leg Standing): \nShift your weight onto your left leg. Hinge at the left hip, lifting and extending your right leg straight back until your torso and right leg are parallel to the floor (or your maximum range). Maintain a tight core and square hips.\n\nAlternating Repetition: \nDrive through the heel of your left leg to return to the standing position. Continue to alternate the standing leg with each repetition, moving with control and focus." },
        ];

        const flowExercises = [
            { name: "Crab Crawl", reps: 2, repDuration: 20, breakBetweenReps: 2, breakBetweenExercises: 15, imgUrl: "exercise/crabcrawl.jpg", explanation: "Starting Position: \nSit on the floor with your knees bent, feet flat on the ground (about hip-width apart). Place your hands on the floor a few centimeters behind your hips, with your fingers pointing directly away from your body (i.e., pointing backward). \n\nThe Lift: \nPress firmly into your hands and feet to lift your hips and torso off the ground. \n\nHip Height: \nKeep your hips slightly lifted off the ground the entire time. The key is to keep tension in your glutes and core so you are not resting your weight fully on your lower back. \n\nHead/Neck: \nKeep your head in a neutral position, looking up at the ceiling or straight ahead. \n\nThe Crawl (Movement): \nBegin to walk forward or backward by moving an opposite arm and leg together (e.g., right hand and left foot, then left hand and right foot). \n\nForward Crawl (Backward Direction): \nTo move your body forward, you will be moving your limbs backward. Lead with the hand and the foot of the opposite side, taking small, controlled steps. \n\nBackward Crawl (Forward Direction): \nTo move your body backward, you will be moving your limbs forward. \n\nMaintaining Form: \nFocus on keeping the hips suspended and elevated off the floor. Do not let your glutes drag. The movement should be deliberate and controlled, not a frantic shuffle." },
            { name: "Bear Crawl", reps: 2, repDuration: 20, breakBetweenReps: 2, breakBetweenExercises: 15, imgUrl: "exercise/bearcrawl.jpg", explanation: "Starting Position (All Fours): \nStart on your hands and knees. Place your hands directly under your shoulders and your knees directly under your hips. Look down at the floor to keep your neck neutral. \n\nThe Lift: \nTuck your toes, engage your core, and lift your knees just a few centimeters off the ground. Your back should be flat and parallel to the floor—imagine balancing a glass of water on your lower back. This is your loaded starting position. \n\nThe Crawl (Movement): \nMove forward by simultaneously stepping with your right hand and left foot, taking small, controlled steps. \n\nOpposite Coordination: \nImmediately follow by stepping with your left hand and right foot. \n\nCrucial Tip: \nMaintain this contralateral (opposite arm and leg) pattern throughout the movement. \n\nMaintaining Form: \nThe key is to keep your back flat, your hips low, and minimize any side-to-side rotation or excessive bouncing of the hips. Your knees must remain hovering just above the ground the entire time." },
            { name: "Side Kick Through", reps: 10, repDuration: 5, breakBetweenReps: 2, breakBetweenExercises: 15, imgUrl: "exercise/Sidekickthrough.png", explanation: "Starting Position (All Fours): \nGet into the Bear Crawl starting position (hands under shoulders, knees under hips). Lift your knees just a few centimeters off the ground. This is your Active Beast hold. \n\nUnload and Pivot: \nTo execute a Right Side Kick Through, you will first lift (unload) the right hand and the left foot (the contralateral limbs). Simultaneously, you will pivot on the ball of your right foot and your left hand. \n\nThe Kick Through: \nSweep your left leg (the unloaded leg) underneath your body and across to the right side, fully extending it straight. The heel should kick through to the side. As you kick through, your right foot (the base foot) should rotate outward to a 90-degree angle, dropping the heel to the floor to create a stable base. Your hips will naturally drop low to the ground. Your right hand (the unloaded hand) will move away from the floor and can reach back toward the kicking foot or extend up/out for balance. \n\nThe Return (Reverse the Movement): \nLift the extended leg and bring it back through the space you created. Simultaneously, place the right hand back down under the shoulder and pivot back onto the ball of your right foot. You should land softly back in the Active Beast (bear crawl) position, ready to repeat on the same side or transition to the other side. \n\nKey Focus Points Opposites Move: \nRemember, the foot you lift is the leg that kicks through, and the hand you lift is the arm that sweeps off the ground. They are contralateral to the movement side (e.g., Left Kick Through uses Right Hand/Left Foot lift). \nControlled Rotation: The power of the movement comes from the controlled rotation of your core and hips. Avoid just flopping into the position. \nShoulder Stack: The grounded hand's shoulder must remain strong, stable, and stacked directly over the wrist." },
            { name: "Front Kick Through", reps: 10, repDuration: 5, breakBetweenReps: 2, breakBetweenExercises: 15, imgUrl: "exercise/frontkickthrough.png", explanation: "Starting Position (All Fours): \nStart in a bear crawl position: hands under shoulders, knees lifted a few centimeters off the ground. \n\nThe Front Step (Load): \nTo initiate a Left Front Kick Through, step your right foot forward and plant it on the outside of your right hand. Simultaneously, lift your right hand off the ground (creating space for the foot) and shift your weight slightly back onto your rear leg. The front knee should be bent (like a deep lunge), your back knee still hovers, and your left hand is in contact with the ground. \n\nThe Kick Through: \nUsing the momentum and stability from your grounded left hand and right foot, forcefully swing your left leg (the backward leg) forward and kick it through the space under your torso, extending it straight infront of you and slightly upward. As the left leg kicks through, you be balancing entirely on your left hand and the ball of your right foot. Your hips will be high. \n\nThe Return (Recoil): \nBring the kicking left leg back to land softly near its starting Front Step position. Simultaneously, plant your right hand back down. \nRepeat but lead with the other leg. \n\nIf this proves too difficult, try just stepping forward and backuntil you are ready to kick your leg though the space under your torso." },
        ];

        const exerciseGroups = [
            { name: "Arms", exercises: armsExercises, used: [] },
            { name: "Core", exercises: coreExercises, used: [] },
            { name: "Legs", exercises: legsExercises, used: [] },
            { name: "Flow", exercises: flowExercises, used: [] },
        ];

        let workoutPlan = []; // This will be dynamically generated
        let currentGroupIndex = 0;
        let currentExercise = 0;
        let currentRep = 1;
        let isBreak = false;
        let timer = null;
        let timeLeft = 0;
        let paused = false;
        let progressTotal = 0; // Will be calculated after workoutPlan is generated
        let progressCount = 0;

        const currentExerciseEl = document.getElementById('current-exercise');
        const exerciseImgEl = document.getElementById('exercise-img');
        const exerciseExplanationEl = document.getElementById('exercise-explanation');
        const timerEl = document.getElementById('timer');
        const statusEl = document.getElementById('status');
        const progressBarEl = document.getElementById('progress-bar');
        const startBtn = document.getElementById('startBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const resumeBtn = document.getElementById('resumeBtn');
        const resetBtn = document.getElementById('resetBtn');
        const skipBtn = document.getElementById('skipBtn');

        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const soundBuffers = {};

        async function loadSound(name, url) {
            try {
                const response = await fetch(url);
                const arrayBuffer = await response.arrayBuffer();
                soundBuffers[name] = await audioContext.decodeAudioData(arrayBuffer);
            } catch (e) {
                console.error(`Failed to load sound "${name}" from ${url}:`, e);
            }
        }

        async function loadAllSounds() {
            await Promise.all([
                loadSound('start', 'exercise/audio_41203856b4.mp3'),
                loadSound('end', 'exercise/audio_336d55dfa8.mp3'),
                loadSound('switch', 'exercise/audio_c50d7fecf2.mp3')
            ]);
        }

        function playSound(name) {
            const buffer = soundBuffers[name];
            if (!buffer) return;
            const source = audioContext.createBufferSource();
            source.buffer = buffer;
            source.connect(audioContext.destination);
            source.start(0);
        }

        document.body.addEventListener('touchstart', unlockAudioContext, { once: true });
        document.body.addEventListener('mousedown', unlockAudioContext, { once: true });

        function unlockAudioContext() {
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
        }

        function formatTime(sec) {
            const m = Math.floor(sec / 60);
            const s = sec % 60;
            return `${m}:${s.toString().padStart(2, '0')}`;
        }

        function updateProgress() {
            const percent = (progressCount / progressTotal) * 100;
            progressBarEl.style.width = percent + '%';
        }

        function startTimer(seconds, onTick, onComplete) {
            timeLeft = seconds;
            timerEl.textContent = formatTime(timeLeft);
            if (timer) clearInterval(timer);
            timer = setInterval(() => {
                if (!paused) {
                    timeLeft--;
                    onTick(timeLeft);
                    timerEl.textContent = formatTime(timeLeft);
                    if (timeLeft <= 0) {
                        clearInterval(timer);
                        onComplete();
                    }
                }
            }, 1000);
        }

        const praises = ["amazing", "awesome", "incredible", "fantastic", "excellent", "superb", "outstanding"];

        const randomPraise = praises[Math.floor(Math.random() * praises.length)];

        function getRandomExercise(group) {
            if (group.used.length === group.exercises.length) {
                group.used = []; // Reset if all exercises in this group have been used
            }
            let availableExercises = group.exercises.filter(ex => !group.used.includes(ex));
            const randomIndex = Math.floor(Math.random() * availableExercises.length);
            const chosenExercise = availableExercises[randomIndex];
            group.used.push(chosenExercise);
            return chosenExercise;
        }

        function generateWorkoutPlan() {
            let generatedPlan = [];
            // Determine how many full cycles of groups we can do
            const minExercisesInGroup = Math.min(...exerciseGroups.map(g => g.exercises.length));
            const numCycles = minExercisesInGroup; // Ensure we don't run out of exercises in any group

            // Reset all group trackers
            exerciseGroups.forEach(group => {
                group.used = [];
            });

            for (let cycle = 0; cycle < numCycles; cycle++) {
                // Iterate through groups in fixed order (Arms, Core, Legs)
                exerciseGroups.forEach(group => {
                    generatedPlan.push(getRandomExercise(group));
                });
            }
            return generatedPlan;
        }

        function nextStep() {
            const nextExerciseImgEl = document.getElementById('next-exercise-img');
            const exerciseVideoEl = document.getElementById('exercise-video');
            const exerciseTextEl = document.getElementById('exercise-text');

            if (currentExercise >= workoutPlan.length) {
                currentExerciseEl.textContent = `Workout Complete! Andy is ${randomPraise}!`;
                exerciseImgEl.style.display = 'none';
                exerciseVideoEl.style.display = 'none';
                exerciseTextEl.style.display = 'none';
                exerciseExplanationEl.textContent = '';
                timerEl.textContent = "";
                statusEl.textContent = "";
                pauseBtn.disabled = true;
                resumeBtn.disabled = true;
                skipBtn.disabled = true;
                resetBtn.disabled = false;
                startBtn.disabled = true;
                document.getElementById('next-exercise').textContent = "";
                nextExerciseImgEl.style.display = 'none';
                return;
            }
            // Clear "next exercise" at the start of a new exercise
            document.getElementById('next-exercise').textContent = "";
            nextExerciseImgEl.style.display = 'none';

            const ex = workoutPlan[currentExercise];

const warmupLength = warmupExercises.length;
const liedownLength = liedownExercises.length;
let groupName = '';

if (currentExercise < warmupLength) {
    groupName = 'Warmup';
} else if (currentExercise < warmupLength + liedownLength) {
    groupName = 'Lie Down';
} else {
    const mainIndex = currentExercise - (warmupLength + liedownLength);
    const groupIndex = mainIndex % exerciseGroups.length; // Use modulo to cycle through groups
    groupName = exerciseGroups[groupIndex].name;
}
currentExerciseEl.textContent = `${ex.name} (${currentExercise + 1} of ${workoutPlan.length})`;
// currentExerciseEl.textContent = `${groupName} - (Exercise ${currentExercise + 1} of ${workoutPlan.length})`;

            // Hide all media elements initially
            exerciseImgEl.style.display = 'none';
            exerciseVideoEl.style.display = 'none';
            exerciseTextEl.style.display = 'none';
            exerciseVideoEl.pause();

            // Determine if it's a video, image, or text
            if (ex.imgUrl.match(/\.(mp4|mov|webm)$/i)) {
                exerciseVideoEl.src = ex.imgUrl;
                exerciseVideoEl.style.display = '';
                exerciseVideoEl.play();
            } else if (ex.imgUrl.match(/\.(jpg|jpeg|png|gif|svg)$/i)) {
                exerciseImgEl.src = ex.imgUrl;
                exerciseImgEl.style.display = '';
            } else {
                // Assume it's text
                exerciseTextEl.textContent = ex.imgUrl;
                exerciseTextEl.style.display = '';
            }
            exerciseExplanationEl.textContent = ex.explanation || '';

            if (!isBreak) {
                statusEl.style.color = 'black';
                timerEl.style.color = 'blue';
                statusEl.textContent = `Rep ${currentRep} of ${ex.reps}`;
                playSound('start'); // Play at the start of every rep
                startTimer(ex.repDuration, () => {
                    progressCount++;
                    updateProgress();
                }, () => {
                    if (currentRep < ex.reps) {
                        playSound('end'); // Play at the end of every rep except the last
                        // Break between reps
                        isBreak = true;
                        statusEl.style.color = 'red';
                        timerEl.style.color = 'red';
                        startBreak(ex.breakBetweenReps, false, () => { // <--- false for between reps
                            isBreak = false;
                            statusEl.style.color = 'black';
                            timerEl.style.color = 'blue';
                            currentRep++;
                            nextStep();
                        });
                    } else {
                        // Break between exercises
                        isBreak = true;
                        statusEl.style.color = 'red';
                        timerEl.style.color = 'red';
                        playSound('switch'); // Only play switch sound after last rep
                        currentRep = 1;
                        currentExercise++;
                        startBreak(ex.breakBetweenExercises, true, () => { // <--- true for between exercises
                            isBreak = false;
                            statusEl.style.color = 'black';
                            timerEl.style.color = 'blue';
                            nextStep();
                        });
                    }
                });
            }
        }

        function startBreak(seconds, isBetweenExercises, callback) {
            const nextExerciseImgEl = document.getElementById('next-exercise-img');
            const nextExerciseVideoEl = document.getElementById('next-exercise-video');
            // const nextExerciseTextEl = document.getElementById('next-exercise-text');
            const exerciseVideoEl = document.getElementById('exercise-video');
            const exerciseTextEl = document.getElementById('exercise-text');

            // Hide current exercise media during break
            exerciseImgEl.style.display = 'none';
            exerciseVideoEl.style.display = 'none';
            exerciseVideoEl.pause();

if (isBetweenExercises) {
    statusEl.textContent = "Break between exercises";
    if (currentExercise < workoutPlan.length) {
        const nextEx = workoutPlan[currentExercise];
        document.getElementById('next-exercise').textContent = `Next: ${nextEx.name}`;

                    // Hide all next media elements initially
                    nextExerciseImgEl.style.display = 'none';
                    nextExerciseVideoEl.style.display = 'none';
                    // nextExerciseTextEl.style.display = 'none';
                    exerciseTextEl.style.display = 'none';
                    nextExerciseVideoEl.pause();

                    // Determine if next is video, image, or text
                    if (nextEx.imgUrl.match(/\.(mp4|mov|webm)$/i)) {
                        nextExerciseVideoEl.src = nextEx.imgUrl;
                        nextExerciseVideoEl.style.display = '';
                        nextExerciseVideoEl.play();
                    } else if (nextEx.imgUrl.match(/\.(jpg|jpeg|png|gif|svg)$/i)) {
                        nextExerciseImgEl.src = nextEx.imgUrl;
                        nextExerciseImgEl.style.display = '';
                    } else {
                        // nextExerciseTextEl.textContent = nextEx.imgUrl;
                        // nextExerciseTextEl.style.display = '';
                        document.getElementById('next-exercise').textContent = nextEx.imgUrl;
                    }
                } else {
                    document.getElementById('next-exercise').textContent = "";
                    nextExerciseImgEl.style.display = 'none';
                    nextExerciseVideoEl.style.display = 'none';
                    // nextExerciseTextEl.style.display = 'none';
                    nextExerciseVideoEl.pause();
                }
            } else {
                // Break between reps - keep current image, hide next
                statusEl.textContent = "Break between reps";
                document.getElementById('next-exercise').textContent = "";
                nextExerciseImgEl.style.display = 'none';
                nextExerciseVideoEl.style.display = 'none';
                // nextExerciseTextEl.style.display = 'none';
                nextExerciseVideoEl.pause();
            }
            startTimer(seconds, () => {
                progressCount++;
                updateProgress();
            }, () => {
                callback();
            });
        }

        function pauseWorkout() {
            paused = true;
            pauseBtn.disabled = true;
            startBtn.disabled = true;
            resumeBtn.disabled = false;
            skipBtn.disabled = true;
            resetBtn.disabled = false; // Enable reset when paused
            statusEl.textContent = "Paused";
        }

        function resumeWorkout() {
            paused = false;
            pauseBtn.disabled = false;
            resumeBtn.disabled = true;
            skipBtn.disabled = false;
            statusEl.textContent = isBreak ? (currentRep === 1 ? "Break between exercises" : "Break between reps") : `Rep ${currentRep} of ${workoutPlan[currentExercise].reps}`;
        }
        function resetWorkout() {
            if (timer) clearInterval(timer);
            currentExercise = 0;
            currentRep = 1;
            isBreak = false;
            paused = false;
            progressCount = 0;
            updateProgress();
            currentExerciseEl.textContent = "";
            exerciseImgEl.style.display = 'none';
            exerciseExplanationEl.textContent = ''; // Clear explanation on reset
            timerEl.textContent = "";
            statusEl.textContent = "";
            pauseBtn.disabled = true;
            resumeBtn.disabled = true;
            resetBtn.disabled = true;
            startBtn.disabled = false;
            document.getElementById('next-exercise').textContent = ""; // Clear next exercise on reset
            document.getElementById('next-exercise-img').style.display = 'none'; // Hide next exercise image on reset
        }

        startBtn.addEventListener('click', () => {
            startBtn.disabled = true;
            pauseBtn.disabled = false;
            skipBtn.disabled = false;
            resetBtn.disabled = false;
            initializeWorkout(); // Re-initialize workout plan on start
            nextStep();
            pauseBtn.disabled = false;
        });

        pauseBtn.addEventListener('click', pauseWorkout);
        resumeBtn.addEventListener('click', resumeWorkout);
        resetBtn.addEventListener('click', resetWorkout);
        skipBtn.addEventListener('click', () => {
            if (timer) clearInterval(timer);
            isBreak = false;
            currentRep = 1;
            currentExercise++;
            nextStep();
        });

        // Initialize UI state
        startBtn.disabled = true;
        loadAllSounds().then(() => {
            startBtn.disabled = false;
            initializeWorkout(); // Call initializeWorkout after sounds are loaded
        });

        function initializeWorkout() {
            const mainPlan = generateWorkoutPlan(); // Generate the main workout plan
            workoutPlan = [...warmupExercises, ...liedownExercises, ...mainPlan]; // Warmup, then lie-down, then main
            progressTotal = workoutPlan.reduce((acc, ex, idx) => {
                const breakBetweenExercises = (idx < workoutPlan.length - 1) ? ex.breakBetweenExercises : 0;
                return acc + ex.reps * (ex.repDuration + ex.breakBetweenReps) + breakBetweenExercises;
            }, 0);
            resetWorkout();
        }
    </script>
</body>

</html>